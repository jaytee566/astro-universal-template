---
import { site } from '../config/site';

interface Props {
  title: string;
  description: string;
  canonicalUrl?: string;
}

const { title, description, canonicalUrl } = Astro.props;
const theme = site.theme;

// ============================================
// THEME CONFIGURATION
// Based on AI Council synthesis - optimized for mobile conversion
// ============================================
const themes = {
  // URGENT: Emergency services - dark hero, red/orange CTAs
  // Use for: Water damage, fire restoration, mold removal, 24/7 services
  // Psychology: Panic mode, immediate action, fear mitigation
  urgent: {
    // Hero section
    heroBg: '#0D1B2A',
    heroText: '#FFFFFF',
    heroSubtext: '#CBD5E1',
    // Primary brand (dark charcoal/navy)
    primary: {
      50: '241 245 249', 100: '226 232 240', 200: '203 213 225',
      300: '148 163 184', 400: '100 116 139', 500: '71 85 105',
      600: '13 27 42', 700: '10 22 34', 800: '8 17 27', 900: '5 11 18'
    },
    // Accent (red for urgency)
    accent: {
      50: '254 242 242', 100: '254 226 226', 200: '254 202 202',
      300: '252 165 165', 400: '248 113 113', 500: '239 68 68',
      600: '220 38 38', 700: '185 28 28', 800: '153 27 27', 900: '127 29 29'
    },
    // CTA button (bright red - high urgency)
    cta: '220 38 38',
    ctaHover: '185 28 28',
    ctaText: '255 255 255',
    // Surface colors
    surface: '255 255 255',
    surfaceAlt: '241 245 249',
    // Fonts
    fontHeading: "'Roboto Condensed', 'Arial Narrow', sans-serif",
    fontBody: "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
  },

  // PREMIUM: Luxury services - light background, navy/gold
  // Use for: Custom pools, estate landscaping, high-end remodeling
  // Psychology: Investment mode, quality-focused, expertise proof
  premium: {
    // Hero section
    heroBg: '#FFFFFF',
    heroText: '#0F172A',
    heroSubtext: '#64748B',
    // Primary brand (deep navy)
    primary: {
      50: '240 249 255', 100: '224 242 254', 200: '186 230 253',
      300: '125 211 252', 400: '56 189 248', 500: '14 165 233',
      600: '15 23 42', 700: '12 18 34', 800: '9 14 26', 900: '6 9 17'
    },
    // Accent (gold for luxury)
    accent: {
      50: '254 252 232', 100: '254 249 195', 200: '254 240 138',
      300: '253 224 71', 400: '250 204 21', 500: '234 179 8',
      600: '212 175 55', 700: '184 134 46', 800: '146 107 37', 900: '120 88 30'
    },
    // CTA button (gold - luxury feel)
    cta: '212 175 55',
    ctaHover: '184 134 46',
    ctaText: '15 23 42',
    // Surface colors
    surface: '255 255 255',
    surfaceAlt: '248 250 252',
    // Fonts
    fontHeading: "'Playfair Display', Georgia, serif",
    fontBody: "'Lato', -apple-system, BlinkMacSystemFont, sans-serif",
  },

  // STANDARD: General services - white background, green/orange
  // Use for: Roofing, foundation, fencing, plumbing, pest control
  // Psychology: Problem-solving, comparing options, value-conscious
  standard: {
    // Hero section
    heroBg: '#FFFFFF',
    heroText: '#1F2937',
    heroSubtext: '#6B7280',
    // Primary brand (trustworthy green)
    primary: {
      50: '240 253 244', 100: '220 252 231', 200: '187 247 208',
      300: '134 239 172', 400: '74 222 128', 500: '34 197 94',
      600: '22 163 74', 700: '21 128 61', 800: '22 101 52', 900: '20 83 45'
    },
    // Accent (action orange)
    accent: {
      50: '255 247 237', 100: '255 237 213', 200: '254 215 170',
      300: '253 186 116', 400: '251 146 60', 500: '249 115 22',
      600: '234 88 12', 700: '194 65 12', 800: '154 52 18', 900: '124 45 18'
    },
    // CTA button (bright orange - action)
    cta: '249 115 22',
    ctaHover: '234 88 12',
    ctaText: '255 255 255',
    // Surface colors
    surface: '255 255 255',
    surfaceAlt: '249 250 251',
    // Fonts
    fontHeading: "'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif",
    fontBody: "'Source Sans Pro', -apple-system, BlinkMacSystemFont, sans-serif",
  },

  // TECHNICAL: Specialized services - light grey, blue/green
  // Use for: Asbestos, radon, commercial HVAC, electrical
  // Psychology: Safety-concerned, compliance-aware, needs certified experts
  technical: {
    // Hero section
    heroBg: '#F0F4F8',
    heroText: '#0F172A',
    heroSubtext: '#64748B',
    // Primary brand (professional blue)
    primary: {
      50: '240 249 255', 100: '224 242 254', 200: '186 230 253',
      300: '125 211 252', 400: '56 189 248', 500: '14 165 233',
      600: '2 132 199', 700: '3 105 161', 800: '7 89 133', 900: '12 74 110'
    },
    // Accent (safety green)
    accent: {
      50: '240 253 244', 100: '220 252 231', 200: '187 247 208',
      300: '134 239 172', 400: '74 222 128', 500: '34 197 94',
      600: '40 167 69', 700: '21 128 61', 800: '22 101 52', 900: '20 83 45'
    },
    // CTA button (safety green - positive outcome)
    cta: '40 167 69',
    ctaHover: '21 128 61',
    ctaText: '255 255 255',
    // Surface colors
    surface: '240 244 248',
    surfaceAlt: '255 255 255',
    // Fonts
    fontHeading: "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
    fontBody: "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
  },
};

const currentTheme = themes[theme] || themes.standard;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}
    
    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Preload fonts for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    {theme === 'urgent' && (
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    )}
    {theme === 'premium' && (
      <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet" />
    )}
    {theme === 'standard' && (
      <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet" />
    )}
    {theme === 'technical' && (
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    )}
    
    <!-- Schema Markup - LocalBusiness -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": site.businessName,
      "description": description,
      "telephone": site.phone,
      "email": site.email,
      "address": {
        "@type": "PostalAddress",
        "addressLocality": site.city,
        "addressRegion": site.state,
        "addressCountry": "US"
      },
      "areaServed": {
        "@type": "City",
        "name": site.city,
        "sameAs": `https://en.wikipedia.org/wiki/${site.city},_${site.stateFullName}`
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": site.rating,
        "reviewCount": site.reviewCount.replace('+', '')
      },
      "priceRange": "$$"
    })} />
  </head>
  <body data-theme={theme} class="min-h-screen bg-surface text-gray-700 font-body antialiased">
    <slot />
  </body>
</html>

<style is:global define:vars={{
  // Hero section
  'hero-bg': currentTheme.heroBg,
  'hero-text': currentTheme.heroText,
  'hero-subtext': currentTheme.heroSubtext,
  // Primary colors
  'color-primary-50': currentTheme.primary[50],
  'color-primary-100': currentTheme.primary[100],
  'color-primary-200': currentTheme.primary[200],
  'color-primary-300': currentTheme.primary[300],
  'color-primary-400': currentTheme.primary[400],
  'color-primary-500': currentTheme.primary[500],
  'color-primary-600': currentTheme.primary[600],
  'color-primary-700': currentTheme.primary[700],
  'color-primary-800': currentTheme.primary[800],
  'color-primary-900': currentTheme.primary[900],
  // Accent colors
  'color-accent-50': currentTheme.accent[50],
  'color-accent-100': currentTheme.accent[100],
  'color-accent-200': currentTheme.accent[200],
  'color-accent-300': currentTheme.accent[300],
  'color-accent-400': currentTheme.accent[400],
  'color-accent-500': currentTheme.accent[500],
  'color-accent-600': currentTheme.accent[600],
  'color-accent-700': currentTheme.accent[700],
  'color-accent-800': currentTheme.accent[800],
  'color-accent-900': currentTheme.accent[900],
  // CTA colors
  'color-cta': currentTheme.cta,
  'color-cta-hover': currentTheme.ctaHover,
  'color-cta-text': currentTheme.ctaText,
  // Surface colors
  'color-surface': currentTheme.surface,
  'color-surface-alt': currentTheme.surfaceAlt,
  // Fonts
  'font-heading': currentTheme.fontHeading,
  'font-body': currentTheme.fontBody,
}}>
  /* ========================================
     FONT SYSTEM
     ======================================== */
  body {
    font-family: var(--font-body);
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-heading);
    font-weight: 700;
  }

  /* ========================================
     HERO SECTION STYLING
     ======================================== */
  .hero-section {
    background: var(--hero-bg);
  }

  .hero-heading {
    color: var(--hero-text);
  }

  .hero-subheading {
    color: var(--hero-subtext);
  }

  /* ========================================
     CTA BUTTON STYLES
     ======================================== */
  .btn-cta {
    background-color: rgb(var(--color-cta));
    color: rgb(var(--color-cta-text));
    position: relative;
    overflow: hidden;
    transition: all 0.2s ease;
  }

  .btn-cta:hover {
    background-color: rgb(var(--color-cta-hover));
  }

  /* Shimmer animation for CTAs */
  .btn-cta::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.3),
      transparent
    );
    animation: shimmer 3s infinite;
  }

  @keyframes shimmer {
    0% { left: -100%; }
    50%, 100% { left: 100%; }
  }

  /* Pulse animation for urgent CTAs */
  .btn-cta-pulse {
    animation: pulse-cta 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes pulse-cta {
    0%, 100% { 
      box-shadow: 0 4px 14px rgba(var(--color-cta), 0.4);
    }
    50% { 
      box-shadow: 0 4px 24px rgba(var(--color-cta), 0.6);
    }
  }

  /* ========================================
     UTILITY CLASSES FOR THEME COLORS
     ======================================== */
  .bg-primary-50 { background-color: rgb(var(--color-primary-50)); }
  .bg-primary-100 { background-color: rgb(var(--color-primary-100)); }
  .bg-primary-200 { background-color: rgb(var(--color-primary-200)); }
  .bg-primary-600 { background-color: rgb(var(--color-primary-600)); }
  .bg-primary-700 { background-color: rgb(var(--color-primary-700)); }
  .bg-accent-500 { background-color: rgb(var(--color-accent-500)); }
  .bg-accent-600 { background-color: rgb(var(--color-accent-600)); }
  .bg-accent-700 { background-color: rgb(var(--color-accent-700)); }

  .text-primary-600 { color: rgb(var(--color-primary-600)); }
  .text-primary-700 { color: rgb(var(--color-primary-700)); }
  .text-accent-600 { color: rgb(var(--color-accent-600)); }
  .text-accent-700 { color: rgb(var(--color-accent-700)); }

  .border-primary-500 { border-color: rgb(var(--color-primary-500)); }
  .border-primary-600 { border-color: rgb(var(--color-primary-600)); }
  .border-accent-600 { border-color: rgb(var(--color-accent-600)); }

  .hover\:bg-primary-600:hover { background-color: rgb(var(--color-primary-600)); }
  .hover\:bg-primary-700:hover { background-color: rgb(var(--color-primary-700)); }
  .hover\:bg-accent-700:hover { background-color: rgb(var(--color-accent-700)); }
  .hover\:text-primary-600:hover { color: rgb(var(--color-primary-600)); }
  .hover\:text-primary-700:hover { color: rgb(var(--color-primary-700)); }

  /* ========================================
     STICKY FOOTER STYLES
     ======================================== */
  .sticky-footer {
    background-color: rgb(var(--color-cta));
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
  }

  .sticky-footer a {
    color: rgb(var(--color-cta-text));
  }

  /* ========================================
     MOBILE-FIRST PHONE LINK STYLING
     ======================================== */
  p a[href^="tel:"],
  .phone-link {
    color: rgb(var(--color-primary-600));
    font-weight: 600;
    text-decoration: underline;
    transition: color 0.2s ease;
  }

  p a[href^="tel:"]:hover,
  .phone-link:hover {
    color: rgb(var(--color-primary-700));
  }

  /* Ensure tap targets are thumb-friendly on mobile (48px minimum) */
  @media (max-width: 768px) {
    a[href^="tel:"] {
      min-height: 48px;
      display: inline-flex;
      align-items: center;
    }
  }

  /* ========================================
     ACCORDION STYLING (FAQ)
     ======================================== */
  details summary {
    cursor: pointer;
    list-style: none;
  }

  details summary::-webkit-details-marker {
    display: none;
  }

  details[open] .chevron-icon {
    transform: rotate(180deg);
  }

  .chevron-icon {
    transition: transform 0.2s ease-in-out;
  }

  /* ========================================
     SMOOTH SCROLL & FOCUS STYLES
     ======================================== */
  html {
    scroll-behavior: smooth;
  }

  a:focus-visible,
  button:focus-visible,
  input:focus-visible,
  textarea:focus-visible {
    outline: 2px solid rgb(var(--color-primary-600));
    outline-offset: 2px;
  }
</style>
