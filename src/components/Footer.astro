---
import { site } from '../config/site';

const locations = site.serviceAreas || [
  { name: 'Downtown', slug: 'downtown' },
  { name: 'East Austin', slug: 'east-austin' },
  { name: 'South Austin', slug: 'south-austin' },
  { name: 'North Austin', slug: 'north-austin' },
  { name: 'West Austin', slug: 'west-austin' },
];

const serviceLocation = site.serviceLocation || { lat: 30.2672, lng: -97.7431 };
const serviceRadius = site.serviceRadius || 15000;
---

<footer class="bg-slate-900 text-white">
  <!-- Service Area Section -->
  <section class="border-b border-slate-800 overflow-hidden" style="contain: paint;">
    <div class="max-w-6xl mx-auto px-4 py-12">
      <h3 class="text-2xl font-bold mb-8 flex items-center gap-2">
        <span>üìç</span> Areas We Serve
      </h3>
      
      <div class="grid md:grid-cols-2 gap-8 items-start">
        <!-- Map Container -->
        <div class="bg-slate-800 rounded-xl overflow-hidden">
          <div id="service-map" class="w-full h-[280px]"></div>
          <div class="bg-gradient-to-t from-slate-900/90 to-transparent p-4 -mt-16 relative z-10 text-center">
            <span class="inline-block bg-orange-500 text-white px-4 py-2 rounded-full text-sm font-semibold">
              Serving {site.city} & Surrounding Areas
            </span>
          </div>
        </div>
        
        <!-- Cities Grid -->
        <div>
          <h4 class="text-orange-500 text-sm uppercase tracking-wider font-semibold mb-4 flex items-center gap-2">
            <span>üìç</span> {site.state || 'Service Areas'}
          </h4>
          <div class="grid grid-cols-2 gap-x-6 gap-y-2">
            {locations.map((location) => (
              <a 
                href={`/neighborhoods/${location.slug}`} 
                class="text-slate-400 hover:text-white transition-colors text-sm py-1"
              >
                {location.name}
              </a>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Main Footer Content -->
  <div class="max-w-6xl mx-auto px-4 py-12">
    <div class="grid md:grid-cols-4 gap-8 mb-12">
      <div class="md:col-span-1">
        <h4 class="font-bold text-lg mb-4">{site.brandName || site.businessName}</h4>
        <p class="text-slate-400 text-sm leading-relaxed mb-4">
          Licensed and insured professionals serving {site.city} and surrounding areas. Available 24/7 for emergency services.
        </p>
        <a 
          href={`tel:${site.phone.replace(/[^0-9]/g, '')}`}
          class="inline-flex items-center gap-2 bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg font-semibold transition-colors"
        >
          <span>üìû</span> {site.phone}
        </a>
      </div>
      
      <div>
        <h4 class="font-bold mb-4">Services</h4>
        <nav class="flex flex-col gap-2">
          {(site.services || []).slice(0, 5).map((service) => (
            <a 
              href={`/services/${service.slug}`} 
              class="text-slate-400 hover:text-white transition-colors text-sm"
            >
              {service.name}
            </a>
          ))}
        </nav>
      </div>
      
      <div>
        <h4 class="font-bold mb-4">Company</h4>
        <nav class="flex flex-col gap-2">
          <a href="/about" class="text-slate-400 hover:text-white transition-colors text-sm">About Us</a>
          <a href="/contact" class="text-slate-400 hover:text-white transition-colors text-sm">Contact</a>
          <a href="/faq" class="text-slate-400 hover:text-white transition-colors text-sm">FAQ</a>
        </nav>
      </div>
      
      <div>
        <h4 class="font-bold mb-4">Legal</h4>
        <nav class="flex flex-col gap-2">
          <a href="/privacy" class="text-slate-400 hover:text-white transition-colors text-sm">Privacy Policy</a>
          <a href="/terms" class="text-slate-400 hover:text-white transition-colors text-sm">Terms of Service</a>
        </nav>
      </div>
    </div>
    
    <div class="border-t border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-slate-500 text-sm">
      <span>¬© {new Date().getFullYear()} {site.brandName || site.businessName}. All rights reserved.</span>
      <span>License #{site.licenseNumber || 'AB-12345'} | Fully Insured</span>
    </div>
  </div>
</footer>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<script define:vars={{ lat: serviceLocation.lat, lng: serviceLocation.lng, radius: serviceRadius }}>
  if (typeof window !== 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
    script.onload = () => {
      const mapContainer = document.getElementById('service-map');
      if (!mapContainer || mapContainer.hasAttribute('data-initialized')) return;
      mapContainer.setAttribute('data-initialized', 'true');
      
      const map = L.map('service-map', {
        center: [lat, lng],
        zoom: 9,
        zoomControl: false,
        scrollWheelZoom: false,
        dragging: false,
        doubleClickZoom: false,
        attributionControl: false
      });

      L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        subdomains: 'abcd',
        maxZoom: 19
      }).addTo(map);

      L.circle([lat, lng], {
        color: '#f97316',
        fillColor: '#f97316',
        fillOpacity: 0.15,
        radius: radius,
        weight: 2
      }).addTo(map);
      
      L.circleMarker([lat, lng], {
        radius: 8,
        fillColor: '#f97316',
        color: '#fff',
        weight: 2,
        opacity: 1,
        fillOpacity: 1
      }).addTo(map);
    };
    document.head.appendChild(script);
  }
</script>
