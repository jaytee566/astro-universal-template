---
/**
 * StickyMobileCTA.astro
 * 
 * Mobile-optimized sticky footer CTA bar
 * Based on AI Council synthesis - optimized for phone call conversions
 * 
 * Key design decisions:
 * - 56-60px height (thumb-friendly, above 48px minimum)
 * - Full-width tap target
 * - Phone number always visible (not just icon)
 * - Template-specific styling via CSS variables
 * - Pulse animation for urgent template
 */

import { site } from '../config/site';

interface Props {
  /** Override default CTA text */
  ctaText?: string;
  /** Show secondary action (quote button) - for standard template */
  showSecondary?: boolean;
}

const { ctaText, showSecondary = false } = Astro.props;
const theme = site.theme;

// Template-specific CTA text (if not overridden)
const defaultCtaText: Record<string, string> = {
  urgent: 'TAP TO CALL FOR HELP',
  premium: 'Schedule Consultation',
  standard: 'Call for Free Quote',
  technical: 'Request Assessment',
};

const displayText = ctaText || defaultCtaText[theme] || 'Call Now';

// Format phone for tel: link (strip non-digits)
const phoneLink = site.phoneLink || site.phone.replace(/\D/g, '');
---

<!-- Spacer to prevent content overlap - matches footer height -->
<div class="h-[72px] md:hidden" aria-hidden="true"></div>

<!-- Sticky Mobile CTA Bar -->
<div class={`
  fixed bottom-0 left-0 right-0 z-50 md:hidden
  sticky-footer
  ${theme === 'urgent' ? 'urgent-footer' : ''}
  ${theme === 'premium' ? 'premium-footer' : ''}
`}>
  
  {/* URGENT: Single prominent red button with pulse */}
  {theme === 'urgent' && (
    <a
      href={`tel:${phoneLink}`}
      class="flex items-center justify-center gap-3 px-4 py-4 font-bold text-lg active:opacity-90 transition-all btn-cta-pulse"
    >
      <svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
      </svg>
      <span>{displayText}</span>
      <span class="font-normal">({site.phone})</span>
    </a>
  )}

  {/* PREMIUM: Elegant split layout with phone and consultation button */}
  {theme === 'premium' && (
    <div class="flex items-center justify-between px-4 py-3 bg-white border-t-2 border-accent-500">
      <a href={`tel:${phoneLink}`} class="text-sm font-medium text-gray-700">
        {site.phone}
      </a>
      <a
        href={`tel:${phoneLink}`}
        class="btn-cta px-5 py-2.5 rounded-lg text-sm font-semibold"
      >
        {displayText}
      </a>
    </div>
  )}

  {/* STANDARD: Two-button layout (Quote + Call) */}
  {theme === 'standard' && (
    <div class="flex gap-3 px-4 py-3 bg-white border-t border-gray-200">
      <a
        href={`tel:${phoneLink}`}
        class="flex-1 btn-cta flex items-center justify-center gap-2 py-3 rounded-xl font-semibold text-sm"
      >
        Get Free Quote
      </a>
      <a
        href={`tel:${phoneLink}`}
        class="flex items-center justify-center gap-2 px-5 py-3 rounded-xl font-semibold text-sm bg-primary-600 text-white"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
        </svg>
        Call
      </a>
    </div>
  )}

  {/* TECHNICAL: Professional split with info and assessment button */}
  {theme === 'technical' && (
    <div class="flex items-center justify-between px-4 py-3 bg-white border-t-2 border-primary-600">
      <div class="text-xs text-gray-600">
        <div class="font-semibold text-gray-900">Free Consultation</div>
        <div>{site.phone}</div>
      </div>
      <a
        href={`tel:${phoneLink}`}
        class="btn-cta px-4 py-2.5 rounded-lg text-sm font-semibold"
      >
        {displayText}
      </a>
    </div>
  )}
</div>

<style>
  /* Urgent template: Red background with pulse effect */
  .urgent-footer {
    background: rgb(var(--color-cta)) !important;
  }
  
  .urgent-footer a {
    color: rgb(var(--color-cta-text));
  }

  /* Premium template: White background with gold accent */
  .premium-footer {
    background: white !important;
    border-top: 2px solid rgb(var(--color-accent-600));
  }

  /* Ensure minimum touch target height */
  .sticky-footer a {
    min-height: 48px;
  }
</style>
